<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Akladell</title>
        <link rel="stylesheet" type="text/css" href="main.css">

    </head>
<body>
    <div class="centered-container">
        <header>
            <h1>Akladell</h1>
        </header>
        <div class="flex-grow">
            <nav>
                <div class="nav-items">
                    <a href="#Home">Home</a>
                    <a href="#Rules">Rules Index</a>
                    <a href="#Updates">Updates</a>
                    <a href="#About">About</a>
                    <a href="#Discord" id="discordlink">Discord</a>
                </div>
            </nav>
            <div id="toc-wrapper">
                <div id="toc-panel">
                    <h2>Table of Contents</h2>
                    <ul>
                        <li><a href="#Character-Creation-Reference">Character Creation Reference</a></li>
                        <li><a href="#General-Gameplay">General Gameplay</a></li>
                        <li><a href="#Combat">Combat</a></li>
                        <li><a href="#Alignment">Alignment</a></li>
                        <li><a href="#Injury-&-Death">Injury & Death</a></li>
                        <li><a href="#Creature-Size">Creature Size</a></li>
                        <li><a href="#Encumbrance-&-Movement">Encumbrance & Movement</a></li>
                    </ul>
                </div>
                <div id="content"></div>
            </div>
        </div>
        <footer><hr></footer>
    </div>


<script type="module">
    import { marked } from '//cdn.jsdelivr.net/npm/marked/lib/marked.esm.js';
    window.loadRulesPage = function() 
    {
        fetch('./rules.md')
        .then(response => response.text())
        .then(data => 
        {
            let htmlContent = marked.parse(data);
            document.getElementById('content').innerHTML = "<div class='rules-content'>" + htmlContent + "</div>";
        });
    }
    document.addEventListener("DOMContentLoaded", function()
    {
    const tocPanel = document.getElementById('toc-panel');

    window.onhashchange = function() 
    {
    var hash = window.location.hash.substring(1);
    if(hash === 'Home') 
    {
        loadHomePage();
    } 
    else if(hash === 'Updates') 
    {
        loadUpdatePost();
    } 
    else if(hash === 'About') 
    {
        loadAboutPage();
    }
    else if(hash === 'Discord') 
    {

    } 
    else 
    {
        window.loadRulesPage();
    }
};

const tocLinks = document.querySelectorAll('#toc-panel a');
tocLinks.forEach(link => {
  link.addEventListener('click', handleTocClick);
});

function handleTocClick(e) {
  e.preventDefault(); // Stop default link behavior
  const hash = this.getAttribute('href'); // Get the link's hash
  loadRulesAndScroll(hash);
}

function loadRulesAndScroll(hash) {
  let hashWithoutPound = hash.substring(1);
  window.loadRulesPage();
  let hashObserver = new MutationObserver(mutations => {
    mutations.forEach(mutation => {
      if(mutation.addedNodes.length) {
        scrollToAnchor(hashWithoutPound);
        hashObserver.disconnect();
      }
    })
  });
  let rulesContent = document.querySelector('.rules-content');
  hashObserver.observe(rulesContent, {childList: true});
}

window.addEventListener('hashchange', scrollToHash);
    // Trigger first hashchange check after all setup has been done.
    window.dispatchEvent(new Event('hashchange'));
});
</script>

    <script src='app.js'></script>

    <noscript>You need to enable JavaScript to view the full site.</noscript>
</body>
</html>
